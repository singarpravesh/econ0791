---
title: "Linear Regression"
format: 
  revealjs:
    warning: false
    message: false
    echo: true
    scrollable: true
    slide-number: true
    touch: true
    smaller: true
editor_options: 
  chunk_output_type: console
---

## Problem Statement

The superintendent of an elementary school district must decide whether to hire additional teachers and she wants your advice. If she hires the teachers, she will reduce the number of students per teacher (the student–teacher ratio) by two. She faces a trade-off. Parents want smaller classes so that their children can receive more individualized attention. But hiring more teachers means spending more money, which is not to the liking of those paying the bill! So she asks you: If she cuts class sizes, what will the effect be on student performance? 

## {.smaller}

- For a sample of $n$ districts, we can write
$$
\text{TestScore} = \beta_0 + \beta_1\text{ClassSize}+ \\ \text{Other factors that infulence student-teacher ratio} 
$$

$$
y = \beta_0 + \beta_1x+ u
$$

---

```{r}
library(AER) 
data('CASchools', package = "AER")
CASchools
```

---

```{r}
library(tidyverse)
as_tibble(CASchools) -> caschools
caschools
```

## Estimating the coefficients 

- Data description
  - Consists of class sizes and test scores in 1998-99 in 420 California districts.
  - **Classes:** 6th and 8th grade students
  - **Class size:** $\frac{\text{Number of students in the district}}{\text{Number of teachers in the district}}$ i.e. district wise student-teacher ratio.

## {.smaller}

- **Task:** Summarize the Distribution of Student–teacher Ratios and 5th-Grade test Scores for 420 Districts in California in 1998-99. *This is Table 4.1 in the book. Page no 161.*
```{r}
#| echo: false
# create new variables "str" and "testscr".
caschools %>% 
  mutate(str = students/teachers,
         testscr = (english+math)/2) -> caschools

# summary table 
caschools %>% 
  pivot_longer(cols = c(str, testscr), names_to = "variables", values_to = "value") %>% 
  group_by(variables) %>% 
  summarise(Average = mean(value),
            `Standard Deviation` = sd(value),
            `Percentile 10%` = quantile(value, 0.1),
            `Percentile 25%` = quantile(value, 0.25),
            Median = quantile(value, 0.5),
            `Percentile 75%` = quantile(value, 0.75)) 
```
- Observations:
  - 10% of districts have student-teacher ratio below 17.3.
  - 50% of the districts have student-teacher ratio below 19.7.

---

- Steps:
  1. Create new variables `str` and `testscr`.
  3. Tidy the data into long format using the variables `str` and `testscr`, and then group them and summarize. You can use `sd()` for standard deviation, `quantile()` for percentiles, and `mean()` for average.
  
---

1. Create new variables `str` and `testscr`.
```{r}
#| code-fold: true
# Create new variables "str" and "testscr".
caschools %>% 
  mutate(str = students/teachers,
         testscr = (read+math)/2) -> caschools
caschools
```

---

2. Tidy and Summarize
```{r}
#| code-fold: true
# summarize
caschools %>% 
  pivot_longer(cols = c(str, testscr), names_to = "variables", values_to = "value") %>% 
  group_by(variables) %>% 
  summarise(Average = mean(value),
            `Standard Deviation` = sd(value),
            `Percentile 10%` = quantile(value, 0.1),
            `Percentile 25%` = quantile(value, 0.25),
            Median = quantile(value, 0.5),
            `Percentile 75%` = quantile(value, 0.75))
```

  
## {.smaller}

- How are the two variables `testscr` and `str` related? Hint:Use scatter plot and correlation coefficient.

```{r}
#| code-fold: true
 
caschools %>% 
  ggplot(aes(x = str, y = testscr))+
  geom_point()+
  labs(x = "Student-Teacher Ratio",
       y = "Test Scores",
       title = 'Scatterplot of test Score vs. Student–teacher Ratio (California School District Data)')
```

- The correlation coefficient is `r round(cor(caschools$str, caschools$testscr),2)`
```{r}
#| code-fold: true
#| eval: false
cor(caschools$str, caschools$testscr)
```


## OLS Estimates {.smaller}

- The OLS equation to be estimated
$$
testscr = \beta_0 + \beta_1 str+ u 
$$


```{r}
lm(testscr ~ str, data = caschools) 
```

- Interpretation:
  - The slope of -2.28 means that an increase in the student–teacher ratio by one student per class is, on average, associated with a decline in districtwide test scores by 2.28 points on the test. 
  - The negative slope indicates that more students per teacher (larger classes) is associated with poorer performance on the test.

## The estimated Regression Line for the California Data {.smaller}

```{r}
#| code-fold: true
caschools %>% 
  ggplot(aes(str, testscr))+
  geom_point()+
  geom_smooth(method = "lm",
              formula = y ~ x, se = FALSE)
```

## Measures of fit {.smaller}

- The $R^2$ and the standard error of the regression measure how well the regression line fits the data.
- The $R^2$ ranges between 0 and 1 and measures the fraction of the variance of $Y_i$ that is explained by $X_i$.
  - An $R^2$ near 1 indicates that the regressor is good at predicting $Y_i$, while an $R^2$ near 0 indicates that the regressor is not  very good at predicting $Y_i$. 
- The standard error of the regression measures how far $Y_i$ typically is from the predicted value.


---

- The regression summary of the linear regression
```{r}
#| code-fold: true
lm(testscr ~ str, data = caschools) %>% 
  summary()
```

- Interpretation
  - The $R^2$ of 0.051 means that the regressor `str` explains $5.1$% of the variance of the dependent variable `testscre`.
  -  The SER of 18.6 means that there is a large spread of the scatterplot around the regression line as measured in points on
the test. 
  - The low $R^2$ and high SER indicate that  the student–teacher ratio alone explains only a small part of the variation in test scores in these data.



